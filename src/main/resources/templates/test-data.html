<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Data Management - Test Automation Framework</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <style>
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
    }
    .container {
        max-width: 1400px;
        background: white;
        border-radius: 15px;
        padding: 30px;
        box-shadow: 0 10px 40px rgba(0,0,0,0.2);
    }
    .header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 20px;
        border-radius: 10px;
        margin-bottom: 30px;
    }
    .data-card {
        border: 2px solid #e0e0e0;
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 20px;
        transition: all 0.3s;
    }
    .data-card:hover {
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        transform: translateY(-2px);
    }
    .category-badge {
        background: #667eea;
        color: white;
        padding: 5px 10px;
        border-radius: 15px;
        font-size: 12px;
    }
    .env-badge {
        padding: 5px 10px;
        border-radius: 15px;
        font-size: 12px;
        font-weight: 600;
    }
    .env-dev {
        background: #28a745;
        color: white;
    }
    .env-qa {
        background: #007bff;
        color: white;
    }
    .env-staging {
        background: #ffc107;
        color: #333;
    }
    .env-prod {
        background: #dc3545;
        color: white;
    }
    .json-preview {
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 5px;
        padding: 10px;
        font-family: 'Courier New', monospace;
        font-size: 12px;
        max-height: 200px;
        overflow-y: auto;
    }
    .json-editor {
        font-family: 'Courier New', monospace;
        font-size: 13px;
    }
  </style>
</head>
<body>
<div class="container">
  <!-- Header -->
  <div class="header">
    <h1><i class="fas fa-database"></i> Test Data Management</h1>
    <p class="mb-0">Manage test data for different environments</p>
  </div>

  <!-- Actions -->
  <div class="row mb-4">
    <div class="col-md-12">
      <button class="btn btn-primary" onclick="showCreateDataModal()">
        <i class="fas fa-plus"></i> Create Test Data
      </button>
      <button class="btn btn-success" onclick="loadTestData()">
        <i class="fas fa-sync"></i> Refresh
      </button>
      <a href="/" class="btn btn-secondary">
        <i class="fas fa-home"></i> Back to Home
      </a>
    </div>
  </div>

  <!-- Filter -->
  <div class="row mb-4">
    <div class="col-md-4">
      <input type="text" class="form-control" id="searchData"
             placeholder="Search test data..." onkeyup="filterTestData()">
    </div>
    <div class="col-md-3">
      <select class="form-select" id="filterCategory" onchange="filterTestData()">
        <option value="">All Categories</option>
        <option value="USER">User Data</option>
        <option value="PRODUCT">Product Data</option>
        <option value="ORDER">Order Data</option>
        <option value="CONFIGURATION">Configuration</option>
        <option value="API">API Data</option>
        <option value="OTHER">Other</option>
      </select>
    </div>
    <div class="col-md-3">
      <select class="form-select" id="filterEnvironment" onchange="filterTestData()">
        <option value="">All Environments</option>
        <option value="DEV">Development</option>
        <option value="QA">QA</option>
        <option value="STAGING">Staging</option>
        <option value="PROD">Production</option>
      </select>
    </div>
  </div>

  <!-- Test Data List -->
  <div id="testDataList">
    <!-- Test data will be loaded here -->
  </div>
</div>

<!-- Create/Edit Data Modal -->
<div class="modal fade" id="dataModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
        <h5 class="modal-title" id="dataModalTitle">Create Test Data</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form id="dataForm">
          <input type="hidden" id="originalDataSetName">

          <div class="row">
            <div class="col-md-6">
              <div class="mb-3">
                <label class="form-label">Data Set Name *</label>
                <input type="text" class="form-control" id="dataSetName"
                       placeholder="LoginUserData" required>
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <label class="form-label">Category *</label>
                <select class="form-select" id="category" required>
                  <option value="USER">User Data</option>
                  <option value="PRODUCT">Product Data</option>
                  <option value="ORDER">Order Data</option>
                  <option value="CONFIGURATION">Configuration</option>
                  <option value="API">API Data</option>
                  <option value="OTHER">Other</option>
                </select>
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-md-6">
              <div class="mb-3">
                <label class="form-label">Environment *</label>
                <select class="form-select" id="environment" required>
                  <option value="DEV">Development</option>
                  <option value="QA" selected>QA</option>
                  <option value="STAGING">Staging</option>
                  <option value="PROD">Production</option>
                </select>
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <label class="form-label">Status</label>
                <div class="form-check form-switch mt-2">
                  <input class="form-check-input" type="checkbox"
                         id="active" checked>
                  <label class="form-check-label" for="active">Active</label>
                </div>
              </div>
            </div>
          </div>

          <div class="mb-3">
            <label class="form-label">Description</label>
            <textarea class="form-control" id="description" rows="2"
                      placeholder="Brief description of this test data"></textarea>
          </div>

          <div class="mb-3">
            <label class="form-label">JSON Data *</label>
            <textarea class="form-control json-editor" id="jsonData" rows="10"
                      placeholder='{
  "username": "testuser",
  "password": "Test@123",
  "email": "test@example.com"
}' required></textarea>
            <small class="text-muted">Enter valid JSON data</small>
          </div>

          <button type="button" class="btn btn-sm btn-info" onclick="formatJSON()">
            <i class="fas fa-align-left"></i> Format JSON
          </button>
          <button type="button" class="btn btn-sm btn-warning" onclick="validateJSON()">
            <i class="fas fa-check"></i> Validate JSON
          </button>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary" onclick="saveTestData()">Save Data</button>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
  let allTestData = [];

  document.addEventListener('DOMContentLoaded', () => {
      loadTestData();
  });

  function loadTestData() {
      fetch('/api/test-data')
          .then(response => response.json())
          .then(data => {
              allTestData = data;
              displayTestData(data);
          })
          .catch(error => {
              console.error('Error loading test data:', error);
              alert('Failed to load test data');
          });
  }

  function displayTestData(data) {
      const list = document.getElementById('testDataList');

      if (data.length === 0) {
          list.innerHTML = '<div class="alert alert-info">No test data found. Create your first data set!</div>';
          return;
      }

      let html = '';
      data.forEach(testData => {
          const envClass = `env-${testData.environment.toLowerCase()}`;
          const dataKeys = Object.keys(testData.data || {});
          const preview = JSON.stringify(testData.data, null, 2).substring(0, 200) + '...';

          html += `
              <div class="data-card">
                  <div class="row">
                      <div class="col-md-8">
                          <h5>
                              <i class="fas fa-database"></i> ${testData.dataSetName}
                              <span class="category-badge">${testData.category}</span>
                              <span class="env-badge ${envClass}">${testData.environment}</span>
                              ${testData.active ? '<i class="fas fa-check-circle text-success"></i>' : '<i class="fas fa-times-circle text-danger"></i>'}
                          </h5>
                          <p class="text-muted mb-2">${testData.description || 'No description'}</p>
                          <div class="json-preview">${preview}</div>
                          <small class="text-muted mt-2">
                              <i class="fas fa-key"></i> ${dataKeys.length} fields
                          </small>
                      </div>
                      <div class="col-md-4 text-end">
                          <button class="btn btn-sm btn-info" onclick="viewData('${testData.dataSetName}')">
                              <i class="fas fa-eye"></i> View
                          </button>
                          <button class="btn btn-sm btn-warning" onclick="editData('${testData.dataSetName}')">
                              <i class="fas fa-edit"></i> Edit
                          </button>
                          <button class="btn btn-sm btn-success" onclick="exportData('${testData.dataSetName}')">
                              <i class="fas fa-download"></i> Export
                          </button>
                          <button class="btn btn-sm btn-danger" onclick="deleteData('${testData.dataSetName}')">
                              <i class="fas fa-trash"></i> Delete
                          </button>
                      </div>
                  </div>
              </div>
          `;
      });

      list.innerHTML = html;
  }

  function filterTestData() {
      const searchText = document.getElementById('searchData').value.toLowerCase();
      const filterCategory = document.getElementById('filterCategory').value;
      const filterEnvironment = document.getElementById('filterEnvironment').value;

      const filtered = allTestData.filter(data => {
          const matchesSearch = data.dataSetName.toLowerCase().includes(searchText) ||
                              (data.description && data.description.toLowerCase().includes(searchText));
          const matchesCategory = !filterCategory || data.category === filterCategory;
          const matchesEnvironment = !filterEnvironment || data.environment === filterEnvironment;

          return matchesSearch && matchesCategory && matchesEnvironment;
      });

      displayTestData(filtered);
  }

  function showCreateDataModal() {
      document.getElementById('dataModalTitle').textContent = 'Create Test Data';
      document.getElementById('dataForm').reset();
      document.getElementById('originalDataSetName').value = '';
      document.getElementById('active').checked = true;
      document.getElementById('jsonData').value = '{\n  \n}';
      new bootstrap.Modal(document.getElementById('dataModal')).show();
  }

  function editData(dataSetName) {
      const data = allTestData.find(d => d.dataSetName === dataSetName);
      if (!data) return;

      document.getElementById('dataModalTitle').textContent = 'Edit Test Data';
      document.getElementById('originalDataSetName').value = dataSetName;
      document.getElementById('dataSetName').value = data.dataSetName;
      document.getElementById('category').value = data.category;
      document.getElementById('environment').value = data.environment;
      document.getElementById('active').checked = data.active;
      document.getElementById('description').value = data.description || '';
      document.getElementById('jsonData').value = JSON.stringify(data.data, null, 2);

      new bootstrap.Modal(document.getElementById('dataModal')).show();
  }

  function saveTestData() {
      const originalDataSetName = document.getElementById('originalDataSetName').value;
      const isEdit = originalDataSetName !== '';

      const jsonText = document.getElementById('jsonData').value;
      let jsonData;

      try {
          jsonData = JSON.parse(jsonText);
      } catch (e) {
          alert('Invalid JSON data. Please check your JSON syntax.');
          return;
      }

      const testData = {
          dataSetName: document.getElementById('dataSetName').value,
          category: document.getElementById('category').value,
          environment: document.getElementById('environment').value,
          active: document.getElementById('active').checked,
          description: document.getElementById('description').value,
          data: jsonData
      };

      const url = isEdit ? `/api/test-data/${originalDataSetName}` : '/api/test-data';
      const method = isEdit ? 'PUT' : 'POST';

      fetch(url, {
          method: method,
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify(testData)
      })
      .then(response => response.json())
      .then(data => {
          if (data.success) {
              alert('Test data saved successfully');
              bootstrap.Modal.getInstance(document.getElementById('dataModal')).hide();
              loadTestData();
          } else {
              alert('Error: ' + (data.message || 'Failed to save test data'));
          }
      })
      .catch(error => {
          console.error('Error saving test data:', error);
          alert('Failed to save test data');
      });
  }

  function viewData(dataSetName) {
      const data = allTestData.find(d => d.dataSetName === dataSetName);
      if (!data) return;

      const formattedData = JSON.stringify(data.data, null, 2);
      alert('Test Data: ' + dataSetName + '\n\n' + formattedData);
  }

  function exportData(dataSetName) {
      const data = allTestData.find(d => d.dataSetName === dataSetName);
      if (!data) return;

      const jsonStr = JSON.stringify(data.data, null, 2);
      const blob = new Blob([jsonStr], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `${dataSetName}.json`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
  }

  function deleteData(dataSetName) {
      if (!confirm(`Delete test data "${dataSetName}"? This action cannot be undone.`)) return;

      fetch(`/api/test-data/${dataSetName}`, {method: 'DELETE'})
          .then(response => response.json())
          .then(data => {
              if (data.success) {
                  alert('Test data deleted successfully');
                  loadTestData();
              } else {
                  alert('Error: ' + data.message);
              }
          })
          .catch(error => {
              console.error('Error deleting test data:', error);
              alert('Failed to delete test data');
          });
  }

  function formatJSON() {
      try {
          const jsonText = document.getElementById('jsonData').value;
          const jsonObj = JSON.parse(jsonText);
          document.getElementById('jsonData').value = JSON.stringify(jsonObj, null, 2);
          alert('JSON formatted successfully');
      } catch (e) {
          alert('Invalid JSON. Cannot format.');
      }
  }

  function validateJSON() {
      try {
          const jsonText = document.getElementById('jsonData').value;
          JSON.parse(jsonText);
          alert('JSON is valid âœ“');
      } catch (e) {
          alert('Invalid JSON: ' + e.message);
      }
  }
</script>
</body>
</html>